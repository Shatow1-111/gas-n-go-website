<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas-n-Go Staff Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen">
    <div class="max-w-5xl mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-10 pb-6 border-b border-slate-800">
            <h1 class="text-3xl font-extrabold text-indigo-400">Gas-n-Go</h1>
            <div id="auth-section">
                <button onclick="login()" class="bg-indigo-600 hover:bg-indigo-500 px-5 py-2 rounded-lg font-semibold transition">
                    Login with Discord
                </button>
            </div>
        </header>

        <main id="content">
            <div class="text-center py-20">
                <p class="text-slate-400">Loading portal...</p>
            </div>
        </main>
    </div>

    <script>
        const WORKER_URL = "https://gas-n-go-website.gruskinkolten.workers.dev";

        function login() {
            window.location.href = `${WORKER_URL}/login`;
        }

        async function init() {
            try {
                // Try fetching applications - this doubles as our login check
                const res = await fetch(`${WORKER_URL}/applications`, { credentials: 'include' });
                
                if (res.status === 401) {
                    document.getElementById('content').innerHTML = '<p class="text-center">Please log in to continue.</p>';
                    return;
                }

                if (res.status === 403) {
                    showApplicantUI();
                } else if (res.ok) {
                    const data = await res.json();
                    showAdminUI(data.documents || []);
                }
            } catch (err) {
                console.error(err);
                document.getElementById('content').innerHTML = '<p class="text-center text-red-400">Error connecting to server.</p>';
            }
        }

        function showApplicantUI() {
            document.getElementById('auth-section').innerHTML = `<span class="text-green-400">User Mode</span>`;
            document.getElementById('content').innerHTML = `
                <div class="max-w-2xl mx-auto bg-slate-800 p-8 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4">Submit Application</h2>
                    <textarea id="app-message" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 mb-4 text-white" rows="5"></textarea>
                    <button onclick="submitApp()" class="w-full bg-indigo-600 py-3 rounded-xl font-bold">Submit</button>
                </div>`;
        }

        function showAdminUI(apps) {
            document.getElementById('auth-section').innerHTML = `<span class="text-indigo-400">Admin Mode</span>`;
            let rows = apps.map(app => `
                <tr class="border-b border-slate-800">
                    <td class="p-4">${app.fields.username?.stringValue || 'User'}</td>
                    <td class="p-4">${app.fields.message?.stringValue || 'No message'}</td>
                </tr>`).join('');
            document.getElementById('content').innerHTML = `
                <h2 class="text-xl font-bold mb-4">Applications</h2>
                <table class="w-full bg-slate-800 rounded-xl overflow-hidden text-left">
                    <tr class="bg-slate-700">
                        <th class="p-4">User</th>
                        <th class="p-4">Message</th>
                    </tr>
                    ${rows}
                </table>`;
        }

        window.onload = init;
    </script>
</body>
</html>
